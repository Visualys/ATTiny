#ifndef lib_oled
#define lib_oled


uint8_t oled_sda, oled_scl;

void oled_start() {
    PORTB |= (oled_sda | oled_scl);              // set all HIGH
    PORTB &= ~oled_sda;
    PORTB &= ~oled_scl;
    }

void oled_stop() {
    PORTB &= ~(oled_sda | oled_scl);             // set all LOW
    PORTB |= oled_scl;
    PORTB |= oled_sda;
    }
    
uint8_t oled_write(uint8_t byte){
    uint8_t i = 128, ret = 0;
    while(i){
        if(i & byte){PORTB |= oled_sda;}else{PORTB &= ~oled_sda;}
        PORTB |= oled_scl;
        PORTB &= ~oled_scl;
        i >>= 1;
        }
    DDRB &= ~oled_sda;
    PORTB |= oled_sda;
    PORTB |= oled_scl;
    if(PINB & oled_sda){ret=0;}else{ret=1;}
    PORTB &= ~oled_scl;
    DDRB |= oled_sda;
    return ret;
    }
 
 uint8_t oled_init(uint8_t sda, uint8_t scl){
    uint8_t ret;
    oled_sda = (1 << sda);
    oled_scl = (1 << scl);
    DDRB |= (oled_sda | oled_scl);
    PORTB |= (oled_sda | oled_scl);
    oled_start();
    ret = oled_write(0x78);
    oled_stop();
    return ret;
    }
 
uint8_t oled_command(){
    uint8_t ret;
    oled_start();
    ret = oled_write(0x78);
    if(ret==0) return 0;
    ret = oled_write(0x80);  // command mode
    if(ret==0) return 0;
    return 1;
    }

uint8_t oled_ram(){
    uint8_t ret;
    oled_start();
    ret = oled_write(0x78);
    if(ret==0) return 0;
    ret = oled_write(0x40);  // ram mode
    if(ret==0) return 0;
    return 1;
    }  

void oled_clear(uint8_t k){  
    uint8_t p, n; 
    for(p=0;p<8;p++){
        if(oled_command()){
            oled_write(0xB0|p);
            oled_stop();
            oled_ram();
            for(uint8_t n=0;n<133;n++){
                oled_write(k);
                }
            oled_stop();
            }
        }
    }
/*
void oled_print(char s[], uint8_t mono){
    uint8_t i=0, c, j, t[]={0,0,0,0,0,0,0,0}, last=1;
    oled_ram();
    while(s[i]){
        c=s[i];
        if(c==32){t[0]=0;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=0;t[6]=0;t[7]=0;}
        else if(c==33){t[0]=0;t[1]=0;t[2]=6;t[3]=95;t[4]=95;t[5]=6;t[6]=0;t[7]=0;}
        else if(c==34){t[0]=0;t[1]=3;t[2]=3;t[3]=0;t[4]=3;t[5]=3;t[6]=0;t[7]=0;}
        else if(c==35){t[0]=20;t[1]=127;t[2]=127;t[3]=20;t[4]=127;t[5]=127;t[6]=20;t[7]=0;}
        else if(c==36){t[0]=36;t[1]=46;t[2]=107;t[3]=107;t[4]=58;t[5]=18;t[6]=0;t[7]=0;}
        else if(c==37){t[0]=70;t[1]=102;t[2]=48;t[3]=24;t[4]=12;t[5]=102;t[6]=98;t[7]=0;}
        else if(c==38){t[0]=48;t[1]=122;t[2]=79;t[3]=93;t[4]=55;t[5]=122;t[6]=72;t[7]=0;}
        else if(c==39){t[0]=4;t[1]=7;t[2]=3;t[3]=0;t[4]=0;t[5]=0;t[6]=0;t[7]=0;}
        else if(c==40){t[0]=0;t[1]=28;t[2]=62;t[3]=99;t[4]=65;t[5]=0;t[6]=0;t[7]=0;}
        else if(c==41){t[0]=0;t[1]=65;t[2]=99;t[3]=62;t[4]=28;t[5]=0;t[6]=0;t[7]=0;}
        else if(c==42){t[0]=8;t[1]=42;t[2]=62;t[3]=28;t[4]=28;t[5]=62;t[6]=42;t[7]=8;}
        else if(c==43){t[0]=8;t[1]=8;t[2]=62;t[3]=62;t[4]=8;t[5]=8;t[6]=0;t[7]=0;}
        else if(c==44){t[0]=0;t[1]=128;t[2]=224;t[3]=96;t[4]=0;t[5]=0;t[6]=0;t[7]=0;}
        else if(c==45){t[0]=8;t[1]=8;t[2]=8;t[3]=8;t[4]=8;t[5]=8;t[6]=0;t[7]=0;}
        else if(c==46){t[0]=0;t[1]=0;t[2]=96;t[3]=96;t[4]=0;t[5]=0;t[6]=0;t[7]=0;}
        else if(c==47){t[0]=96;t[1]=48;t[2]=24;t[3]=12;t[4]=6;t[5]=3;t[6]=1;t[7]=0;}
        else if(c==48){t[0]=62;t[1]=127;t[2]=113;t[3]=89;t[4]=77;t[5]=127;t[6]=62;t[7]=0;}
        else if(c==49){t[0]=64;t[1]=66;t[2]=127;t[3]=127;t[4]=64;t[5]=64;t[6]=0;t[7]=0;}
        else if(c==50){t[0]=98;t[1]=115;t[2]=89;t[3]=73;t[4]=111;t[5]=102;t[6]=0;t[7]=0;}
        else if(c==51){t[0]=34;t[1]=99;t[2]=73;t[3]=73;t[4]=127;t[5]=54;t[6]=0;t[7]=0;}
        else if(c==52){t[0]=24;t[1]=28;t[2]=22;t[3]=83;t[4]=127;t[5]=127;t[6]=80;t[7]=0;}
        else if(c==53){t[0]=39;t[1]=103;t[2]=69;t[3]=69;t[4]=125;t[5]=57;t[6]=0;t[7]=0;}
        else if(c==54){t[0]=60;t[1]=126;t[2]=75;t[3]=73;t[4]=121;t[5]=48;t[6]=0;t[7]=0;}
        else if(c==55){t[0]=3;t[1]=3;t[2]=113;t[3]=121;t[4]=15;t[5]=7;t[6]=0;t[7]=0;}
        else if(c==56){t[0]=54;t[1]=127;t[2]=73;t[3]=73;t[4]=127;t[5]=54;t[6]=0;t[7]=0;}
        else if(c==57){t[0]=6;t[1]=79;t[2]=73;t[3]=105;t[4]=63;t[5]=30;t[6]=0;t[7]=0;}
        else if(c==58){t[0]=0;t[1]=0;t[2]=102;t[3]=102;t[4]=0;t[5]=0;t[6]=0;t[7]=0;}
        else if(c==59){t[0]=0;t[1]=128;t[2]=230;t[3]=102;t[4]=0;t[5]=0;t[6]=0;t[7]=0;}
        else if(c==60){t[0]=8;t[1]=28;t[2]=54;t[3]=99;t[4]=65;t[5]=0;t[6]=0;t[7]=0;}
        else if(c==61){t[0]=36;t[1]=36;t[2]=36;t[3]=36;t[4]=36;t[5]=36;t[6]=0;t[7]=0;}
        else if(c==62){t[0]=0;t[1]=65;t[2]=99;t[3]=54;t[4]=28;t[5]=8;t[6]=0;t[7]=0;}
        else if(c==63){t[0]=2;t[1]=3;t[2]=81;t[3]=89;t[4]=15;t[5]=6;t[6]=0;t[7]=0;}
        else if(c==64){t[0]=62;t[1]=127;t[2]=65;t[3]=93;t[4]=93;t[5]=31;t[6]=30;t[7]=0;}
        else if(c==65){t[0]=124;t[1]=126;t[2]=19;t[3]=19;t[4]=126;t[5]=124;t[6]=0;t[7]=0;}
        else if(c==66){t[0]=65;t[1]=127;t[2]=127;t[3]=73;t[4]=73;t[5]=127;t[6]=54;t[7]=0;}
        else if(c==67){t[0]=28;t[1]=62;t[2]=99;t[3]=65;t[4]=65;t[5]=99;t[6]=34;t[7]=0;}
        else if(c==68){t[0]=65;t[1]=127;t[2]=127;t[3]=65;t[4]=99;t[5]=62;t[6]=28;t[7]=0;}
        else if(c==69){t[0]=65;t[1]=127;t[2]=127;t[3]=73;t[4]=93;t[5]=65;t[6]=99;t[7]=0;}
        else if(c==70){t[0]=65;t[1]=127;t[2]=127;t[3]=73;t[4]=29;t[5]=1;t[6]=3;t[7]=0;}
        else if(c==71){t[0]=28;t[1]=62;t[2]=99;t[3]=65;t[4]=81;t[5]=115;t[6]=114;t[7]=0;}
        else if(c==72){t[0]=127;t[1]=127;t[2]=8;t[3]=8;t[4]=127;t[5]=127;t[6]=0;t[7]=0;}
        else if(c==73){t[0]=0;t[1]=65;t[2]=127;t[3]=127;t[4]=65;t[5]=0;t[6]=0;t[7]=0;}
        else if(c==74){t[0]=48;t[1]=112;t[2]=64;t[3]=65;t[4]=127;t[5]=63;t[6]=1;t[7]=0;}
        else if(c==75){t[0]=65;t[1]=127;t[2]=127;t[3]=8;t[4]=28;t[5]=119;t[6]=99;t[7]=0;}
        else if(c==76){t[0]=65;t[1]=127;t[2]=127;t[3]=65;t[4]=64;t[5]=96;t[6]=112;t[7]=0;}
        else if(c==77){t[0]=127;t[1]=127;t[2]=14;t[3]=28;t[4]=14;t[5]=127;t[6]=127;t[7]=0;}
        else if(c==78){t[0]=127;t[1]=127;t[2]=6;t[3]=12;t[4]=24;t[5]=127;t[6]=127;t[7]=0;}
        else if(c==79){t[0]=28;t[1]=62;t[2]=99;t[3]=65;t[4]=99;t[5]=62;t[6]=28;t[7]=0;}
        else if(c==80){t[0]=65;t[1]=127;t[2]=127;t[3]=73;t[4]=9;t[5]=15;t[6]=6;t[7]=0;}
        else if(c==81){t[0]=30;t[1]=63;t[2]=33;t[3]=113;t[4]=127;t[5]=94;t[6]=0;t[7]=0;}
        else if(c==82){t[0]=65;t[1]=127;t[2]=127;t[3]=9;t[4]=25;t[5]=127;t[6]=102;t[7]=0;}
        else if(c==83){t[0]=38;t[1]=111;t[2]=77;t[3]=89;t[4]=115;t[5]=50;t[6]=0;t[7]=0;}
        else if(c==84){t[0]=3;t[1]=65;t[2]=127;t[3]=127;t[4]=65;t[5]=3;t[6]=0;t[7]=0;}
        else if(c==85){t[0]=127;t[1]=127;t[2]=64;t[3]=64;t[4]=127;t[5]=127;t[6]=0;t[7]=0;}
        else if(c==86){t[0]=31;t[1]=63;t[2]=96;t[3]=96;t[4]=63;t[5]=31;t[6]=0;t[7]=0;}
        else if(c==87){t[0]=127;t[1]=127;t[2]=48;t[3]=24;t[4]=48;t[5]=127;t[6]=127;t[7]=0;}
        else if(c==88){t[0]=67;t[1]=103;t[2]=60;t[3]=24;t[4]=60;t[5]=103;t[6]=67;t[7]=0;}
        else if(c==89){t[0]=7;t[1]=79;t[2]=120;t[3]=120;t[4]=79;t[5]=7;t[6]=0;t[7]=0;}
        else if(c==90){t[0]=71;t[1]=99;t[2]=113;t[3]=89;t[4]=77;t[5]=103;t[6]=115;t[7]=0;}
        else if(c==91){t[0]=0;t[1]=127;t[2]=127;t[3]=65;t[4]=65;t[5]=0;t[6]=0;t[7]=0;}
        else if(c==92){t[0]=1;t[1]=3;t[2]=6;t[3]=12;t[4]=24;t[5]=48;t[6]=96;t[7]=0;}
        else if(c==93){t[0]=0;t[1]=65;t[2]=65;t[3]=127;t[4]=127;t[5]=0;t[6]=0;t[7]=0;}
        else if(c==94){t[0]=8;t[1]=12;t[2]=6;t[3]=3;t[4]=6;t[5]=12;t[6]=8;t[7]=0;}
        else if(c==95){t[0]=128;t[1]=128;t[2]=128;t[3]=128;t[4]=128;t[5]=128;t[6]=128;t[7]=128;}
        else if(c==96){t[0]=0;t[1]=0;t[2]=3;t[3]=7;t[4]=4;t[5]=0;t[6]=0;t[7]=0;}
        else if(c==97){t[0]=32;t[1]=116;t[2]=84;t[3]=84;t[4]=60;t[5]=120;t[6]=64;t[7]=0;}
        else if(c==98){t[0]=65;t[1]=127;t[2]=63;t[3]=72;t[4]=72;t[5]=120;t[6]=48;t[7]=0;}
        else if(c==99){t[0]=56;t[1]=124;t[2]=68;t[3]=68;t[4]=108;t[5]=40;t[6]=0;t[7]=0;}
        else if(c==100){t[0]=48;t[1]=120;t[2]=72;t[3]=73;t[4]=63;t[5]=127;t[6]=64;t[7]=0;}
        else if(c==101){t[0]=56;t[1]=124;t[2]=84;t[3]=84;t[4]=92;t[5]=24;t[6]=0;t[7]=0;}
        else if(c==102){t[0]=72;t[1]=126;t[2]=127;t[3]=73;t[4]=3;t[5]=2;t[6]=0;t[7]=0;}
        else if(c==103){t[0]=152;t[1]=188;t[2]=164;t[3]=164;t[4]=248;t[5]=124;t[6]=4;t[7]=0;}
        else if(c==104){t[0]=65;t[1]=127;t[2]=127;t[3]=8;t[4]=4;t[5]=124;t[6]=120;t[7]=0;}
        else if(c==105){t[0]=0;t[1]=68;t[2]=125;t[3]=125;t[4]=64;t[5]=0;t[6]=0;t[7]=0;}
        else if(c==106){t[0]=96;t[1]=224;t[2]=128;t[3]=128;t[4]=253;t[5]=125;t[6]=0;t[7]=0;}
        else if(c==107){t[0]=65;t[1]=127;t[2]=127;t[3]=16;t[4]=56;t[5]=108;t[6]=68;t[7]=0;}
        else if(c==108){t[0]=0;t[1]=65;t[2]=127;t[3]=127;t[4]=64;t[5]=0;t[6]=0;t[7]=0;}
        else if(c==109){t[0]=124;t[1]=124;t[2]=24;t[3]=56;t[4]=28;t[5]=124;t[6]=120;t[7]=0;}
        else if(c==110){t[0]=124;t[1]=124;t[2]=4;t[3]=4;t[4]=124;t[5]=120;t[6]=0;t[7]=0;}
        else if(c==111){t[0]=56;t[1]=124;t[2]=68;t[3]=68;t[4]=124;t[5]=56;t[6]=0;t[7]=0;}
        else if(c==112){t[0]=132;t[1]=252;t[2]=248;t[3]=164;t[4]=36;t[5]=60;t[6]=24;t[7]=0;}
        else if(c==113){t[0]=24;t[1]=60;t[2]=36;t[3]=164;t[4]=248;t[5]=252;t[6]=132;t[7]=0;}
        else if(c==114){t[0]=68;t[1]=124;t[2]=120;t[3]=76;t[4]=4;t[5]=28;t[6]=24;t[7]=0;}
        else if(c==115){t[0]=72;t[1]=92;t[2]=84;t[3]=84;t[4]=116;t[5]=36;t[6]=0;t[7]=0;}
        else if(c==116){t[0]=0;t[1]=4;t[2]=62;t[3]=127;t[4]=68;t[5]=36;t[6]=0;t[7]=0;}
        else if(c==117){t[0]=60;t[1]=124;t[2]=64;t[3]=64;t[4]=60;t[5]=124;t[6]=64;t[7]=0;}
        else if(c==118){t[0]=28;t[1]=60;t[2]=96;t[3]=96;t[4]=60;t[5]=28;t[6]=0;t[7]=0;}
        else if(c==119){t[0]=60;t[1]=124;t[2]=112;t[3]=56;t[4]=112;t[5]=124;t[6]=60;t[7]=0;}
        else if(c==120){t[0]=68;t[1]=108;t[2]=56;t[3]=16;t[4]=56;t[5]=108;t[6]=68;t[7]=0;}
        else if(c==121){t[0]=156;t[1]=188;t[2]=160;t[3]=160;t[4]=252;t[5]=124;t[6]=0;t[7]=0;}
        else if(c==122){t[0]=76;t[1]=100;t[2]=116;t[3]=92;t[4]=76;t[5]=100;t[6]=0;t[7]=0;}
        else if(c==123){t[0]=8;t[1]=8;t[2]=62;t[3]=119;t[4]=65;t[5]=65;t[6]=0;t[7]=0;}
        else if(c==124){t[0]=0;t[1]=0;t[2]=0;t[3]=119;t[4]=119;t[5]=0;t[6]=0;t[7]=0;}
        else if(c==125){t[0]=65;t[1]=65;t[2]=119;t[3]=62;t[4]=8;t[5]=8;t[6]=0;t[7]=0;}
        else if(c==126){t[0]=2;t[1]=3;t[2]=1;t[3]=3;t[4]=2;t[5]=3;t[6]=1;t[7]=0;}
        else if(c==176){t[0]=0;t[1]=6;t[2]=9;t[3]=9;t[4]=6;t[5]=0;t[6]=0;t[7]=0;}
        else{t[0]=0;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=0;t[6]=0;t[7]=0;}
        for(j=0;j<8;j++){
            if(mono || c==32) {oled_write(t[j]);}
            else if(t[j]==0 && last==0){} 
            else{oled_write(t[j]); last=t[j];} 
            }
        i++;
        }
    oled_stop();
    }
*/
void oled_cmd(uint8_t cmd){
	oled_command(); 
	oled_write(cmd);
	oled_stop();
    }

void oled_locate(uint8_t x,uint8_t y){
	oled_cmd(0xB0+(y & 7)); //page
	oled_cmd(2+(x & 0x0F)); 
	oled_cmd(0x10 | (x>>4)); 
	}
#endif

void oled_print2(char s[], uint8_t x, uint8_t y){
    uint8_t i, c, j, t[]={0,0,0,0,0,0,0,0,0};
    oled_locate(x,y);
    oled_ram();
    i=0;
    while(s[i]){
        c=s[i];
        if(c==48){t[0]=240;t[1]=248;t[2]=12;t[3]=6;t[4]=6;t[5]=6;t[6]=12;t[7]=248;t[8]=240;t[9]=0;}
        else if(c==49){t[0]=16;t[1]=24;t[2]=12;t[3]=6;t[4]=254;t[5]=254;t[6]=0;t[7]=0;t[8]=0;t[9]=0;}
        else if(c==50){t[0]=24;t[1]=12;t[2]=6;t[3]=6;t[4]=6;t[5]=6;t[6]=252;t[7]=248;t[8]=0;t[9]=0;}
        else if(c==51){t[0]=12;t[1]=134;t[2]=134;t[3]=134;t[4]=134;t[5]=134;t[6]=198;t[7]=124;t[8]=56;t[9]=0;}
        else if(c==52){t[0]=0;t[1]=0;t[2]=192;t[3]=240;t[4]=28;t[5]=254;t[6]=254;t[7]=0;t[8]=0;t[9]=0;}
        else if(c==53){t[0]=254;t[1]=254;t[2]=134;t[3]=134;t[4]=134;t[5]=134;t[6]=6;t[7]=6;t[8]=0;t[9]=0;}
        else if(c==54){t[0]=224;t[1]=248;t[2]=28;t[3]=140;t[4]=134;t[5]=134;t[6]=134;t[7]=4;t[8]=0;t[9]=0;}
        else if(c==55){t[0]=6;t[1]=6;t[2]=6;t[3]=6;t[4]=134;t[5]=198;t[6]=246;t[7]=62;t[8]=14;t[9]=0;}
        else if(c==56){t[0]=120;t[1]=252;t[2]=198;t[3]=134;t[4]=134;t[5]=134;t[6]=198;t[7]=252;t[8]=120;t[9]=0;}
        else if{c==57){t[0]=248;t[1]=252;t[2]=6;t[3]=2;t[4]=2;t[5]=2;t[6]=134;t[7]=252;t[8]=248;t[9]=0;}
	else if(c==45){t[0]=0;t[1]=128;t[2]=128;t[3]=128;t[4]=128;t[5]=128;t[6]=128;t[7]=128;t[8]=0;}
        else if(c==46){t[0]=0;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=0;t[6]=0;t[7]=0;t[8]=0;}
        else if(c==84){t[0]=0;t[1]=0;t[2]=252;t[3]=2;t[4]=226;t[5]=2;t[6]=252;t[7]=0;t[8]=0;}
        else if(c==72){t[0]=0;t[1]=128;t[2]=96;t[3]=24;t[4]=6;t[5]=24;t[6]=96;t[7]=128;t[8]=0;}
        else{t[0]=0;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=0;t[6]=0;t[7]=0;t[8]=0;}
        for(j=0;j<9;j++){oled_write(t[j]);}
        oled_write(0);
        i++;
        }
    oled_stop();
    
    oled_locate(x,y+1);
    oled_ram();
    i=0;
    while(s[i]){
        c=s[i];
        if(c==48){t[0]=31;t[1]=63;t[2]=96;t[3]=192;t[4]=192;t[5]=192;t[6]=96;t[7]=63;t[8]=31;t[9]=0;}
        else if(c==49){t[0]=192;t[1]=192;t[2]=192;t[3]=192;t[4]=255;t[5]=255;t[6]=192;t[7]=192;t[8]=192;t[9]=0;}
        else if(c==50){t[0]=224;t[1]=240;t[2]=216;t[3]=204;t[4]=198;t[5]=195;t[6]=193;t[7]=192;t[8]=192;t[9]=0;}
        else if(c==51){t[0]=64;t[1]=193;t[2]=193;t[3]=193;t[4]=193;t[5]=193;t[6]=99;t[7]=62;t[8]=28;t[9]=0;}
        else if(c==52){t[0]=28;t[1]=31;t[2]=27;t[3]=24;t[4]=24;t[5]=255;t[6]=255;t[7]=24;t[8]=24;t[9]=0;}
        else if(c==53){t[0]=65;t[1]=193;t[2]=193;t[3]=193;t[4]=193;t[5]=193;t[6]=99;t[7]=127;t[8]=30;t[9]=0;}
        else if(c==54){t[0]=63;t[1]=127;t[2]=195;t[3]=129;t[4]=129;t[5]=129;t[6]=193;t[7]=127;t[8]=62;t[9]=0;}
        else if(c==55){t[0]=0;t[1]=192;t[2]=248;t[3]=62;t[4]=7;t[5]=1;t[6]=0;t[7]=0;t[8]=0;t[9]=0;}
        else if(c==56){t[0]=124;t[1]=254;t[2]=195;t[3]=193;t[4]=193;t[5]=193;t[6]=195;t[7]=254;t[8]=124;t[9]=0;}
	else if{c==57){t[0]=0;t[1]=65;t[2]=195;t[3]=195;t[4]=195;t[5]=99;t[6]=113;t[7]=63;t[8]=15;t[9]=0;}
        else if(c==45){t[0]=0;t[1]=1;t[2]=1;t[3]=1;t[4]=1;t[5]=1;t[6]=1;t[7]=1;t[8]=0;}
        else if(c==46){t[0]=0;t[1]=0;t[2]=0;t[3]=96;t[4]=240;t[5]=240;t[6]=96;t[7]=0;t[8]=0;}
        else if(c==84){t[0]=60;t[1]=66;t[2]=129;t[3]=152;t[4]=191;t[5]=152;t[6]=129;t[7]=66;t[8]=60;}
        else if(c==72){t[0]=30;t[1]=33;t[2]=64;t[3]=137;t[4]=132;t[5]=146;t[6]=64;t[7]=33;t[8]=30;}
        else{t[0]=0;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=0;t[6]=0;t[7]=0;t[8]=0;}
        for(j=0;j<9;j++){oled_write(t[j]);}
        oled_write(0);
        i++;
        }
    oled_stop();   
    }
